# Laravel Forge Nginx Configuration for Node.js Blog
# Domain: meganews.on-forge.com
# Site ID: 2914617
# 
# READY TO USE - Copy this entire config to: Site → Nginx → Edit Configuration

ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
ssl_prefer_server_ciphers off;
ssl_dhparam /etc/nginx/dhparams.pem;

add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
add_header X-Content-Type-Options "nosniff";

# Set root directory for static files
root /home/forge/meganews.on-forge.com/current/auto\ blog-appv1;

index index.html index.htm;

charset utf-8;

# FORGE CONFIG (DO NOT REMOVE!)
include forge-conf/2914617/server/*;

# API and Backend Proxy - All /api requests go to Node.js
location /api {
    proxy_pass http://127.0.0.1:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
    proxy_read_timeout 300s;
    proxy_connect_timeout 75s;
}

# WebSocket support (for Socket.io)
location /socket.io {
    proxy_pass http://127.0.0.1:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# RSS Feed
location /feed.xml {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
}

# Sitemap
location /sitemap.xml {
    proxy_pass http://127.0.0.1:3000;
    proxy_set_header Host $host;
}

# Serve admin panel
location /admin {
    alias /home/forge/meganews.on-forge.com/current/admin-panel/build;
    try_files $uri $uri/ /admin/index.html;
    index index.html;
}

# Serve static files from blog frontend
location / {
    try_files $uri $uri/ /index.html;
}

location = /favicon.ico { access_log off; log_not_found off; }
location = /robots.txt  { access_log off; log_not_found off; }

access_log off;
error_log  /var/log/nginx/2914617-error.log error;

location ~ /\.(?!well-known).* {
    deny all;
}

